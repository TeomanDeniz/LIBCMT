.TH CMT_CLEAR_INSTRUCTION_CACHE 3 "CMT" "CMT_CLEAR_INSTRUCTION_CACHE" "Cache Control"

.SH NAME
CMT_CLEAR_INSTRUCTION_CACHE \- Ensure freshly written machine code is executed

.SH SYNOPSIS
.B #define INCL__CLEAR_INSTRUCTION_CACHE
.br
.B #include <CMT/CMT.H>

.SH FILES
CMT/FUNCTIONS/CLEAR_INSTRUCTION_CACHE.H

.SH DESCRIPTION
Provides a macro to synchronize data and instruction caches after writing
machine code to memory. This ensures that newly written instructions are
visible to the CPU before execution.

Modern CPUs may keep separate data and instruction caches. Writing bytes
updates the data cache, but the instruction cache may still contain stale
instructions for the same address range.

Without flushing or invalidation, the CPU may execute outdated or garbage
instructions.

.TP
.B CLEAR_INSTRUCTION_CACHE, clear_instruction_cache
Flushes data cache lines and invalidates instruction cache lines covering
the specified address range.

.SH USAGE
.nf
memcpy(code_ptr, bytes, size);
CLEAR_INSTRUCTION_CACHE(code_ptr, code_ptr + size);
mprotect(page, RX);
.fi

.SH EFFECTS
After calling the macro:

- Data cache lines covering [begin, end) are written back
- Instruction cache lines covering [begin, end) are invalidated
- Subsequent execution fetches the new instructions from memory

.SH ARCHITECTURE NOTES
- x86: Usually no visible effect
- ARM / RISC-V / MIPS: Mandatory for correctness

.SH SEE ALSO
.B CMT(3)

.SH AUTHOR
Teoman Deniz <te.odenizgml@gmail.com>
